window.addEventListener("load",()=>{const e={wrapper:".wrapper",rays:".rays",wheel:".wheels>.wheel",slices:".wheels>.wheel>.slices",ticker:".wheels>.ticker",question:".question",qtext:".question>.text",qform:".question>.form",qinput:".question>.form>.input",answer:".answers>.answer",submit:".question>.submit"},t={};Object.keys(e).forEach(a=>t[a]=document.querySelector(e[a]));const a=()=>{const e=Math.min(1,window.innerWidth/700,window.innerHeight/900);t.wrapper.style.transform=`translate(-50%, -50%) scale(${e})`,t.wrapper.style.width=`${window.innerWidth*(1/e)}px`,t.wrapper.style.height=`${window.innerHeight*(1/e)}px`};a(),window.addEventListener("resize",a);for(let e=0;e<9;e++){const a=document.createElement("div");a.className="ray",a.style.transform=`rotate(${40*e}deg)`,t.rays.appendChild(a)}gsap.to(t.rays,{rotate:360,duration:100,ease:"none",repeat:-1});const s=[];for(let e=0;e<18;e++){const a=document.createElement("div");a.className="slice";const n=20*e;a.style.transform=`rotate(${n}deg)`;const o=document.createElement("div");o.className="image",o.style.background=`url(images/slice${e%6+1}.svg) no-repeat top/contain`,a.appendChild(o),t.slices.appendChild(a),s.push(a)}const n=(e,t,a,s)=>{let n=s;for(e.style.fontSize=`${n}px`;n&&(t<e.scrollWidth||a<e.scrollHeight);)n--,e.style.fontSize=`${n}px`},o=e=>{t.answer.innerHTML=e,n(t.answer,650,100,60)},r=()=>{t.answer.innerHTML="",gsap.set(t.answer,{display:"block",scale:1,color:"#fff",textShadow:"0 5px #1e3c6f"}),gsap.set(t.wheel,{rotate:gsap.getProperty(t.wheel,"rotate")%360}),gsap.set(s,{filter:"brightness(1)"})},i=e=>{t.submit.innerText=e,gsap.fromTo(t.submit,{scale:.3,translateX:"-80px",translateY:"-30px",display:"block"},{scale:1,translateX:0,translateY:0,duration:.5,ease:"expo.out"})},l=()=>new Promise(e=>gsap.to(t.submit,{scale:.3,translateX:"-80px",translateY:"-30px",display:"none",duration:.3,ease:"power3.in",onComplete:e}));i("Submit");let p=!1;let c=!0;const d=()=>{const e=t.qinput.value.trim();if(!c||!e)return;c=!1,l(),t.question.classList.add("inputted"),t.qtext.innerText=e,n(t.qtext,680,65,40),gsap.fromTo(t.question,{scale:1.1},{duration:.5,scale:1,ease:"circ.out"});const a=[],d=FindBucket(e).answers;for(let e=0;e<18;e++)a.push(d[Math.floor(Math.random()*d.length)]);(e=>{r();const a=()=>Math.floor((360-gsap.getProperty(t.wheel,"rotate")%360+10)/20)%18,n=Math.random(),l=SpinTypes.payload.filter(e=>"default"==e.category).find(e=>n>=e.minPower&&n<e.maxPower),c=l.minSpin+Math.floor((l.maxSpin-l.minSpin)*Math.random());let d=0,u=null;const m=gsap.to(t.wheel,{rotate:c,duration:l.durationInSec,ease:l.customEaseData,onUpdate:()=>{const s=a();s!=d&&(m.time()>1&&(o(e[s].replace(/\S/g,"?")),gsap.fromTo(t.answer,{scale:1.05},{scale:1,duration:.1,ease:"none"})),d=s,u&&u.kill(),u=gsap.fromTo(t.ticker,{rotate:-100},{duration:.1,rotate:-90,delay:.1}))},onComplete:()=>{const n=a(),r=s[n];gsap.to(r,{filter:"brightness(1.8)",duration:.5,ease:"power3.out"}),o(e[n].replace(/\[i\](.+?)\[\/i\]/g,"<i>$1</i>")),gsap.timeline().fromTo(t.answer,{scale:.5,color:"#1e3d6f",textShadow:"0 3px #0c1e3c"},{scale:1.1,color:"#ffd780",textShadow:"0 6px #d4864e, 0 5px 10px #ffdb8e, 0 5px 10px #ffdb8e",duration:.3,ease:"expo.in"}).to(t.answer,{scale:1,color:"#f8a900",textShadow:"0 5px #a24300",duration:.8,ease:"power3.inOut"}),setTimeout(()=>{p=!0,i("Reset")},1e3)}})})(a)};t.qform.addEventListener("submit",e=>{e.preventDefault(),d()}),t.submit.addEventListener("click",()=>{if(p)return p=!1,gsap.to(t.answer,{scale:.4,display:"none",duration:.3,ease:"expo.in",onComplete:r}),gsap.to(s,{filter:"brightness(1)",duration:.3,ease:"expo.in"}),t.question.classList.remove("inputted"),t.qinput.value="",t.qinput.focus(),gsap.fromTo(t.question,{scale:.8},{duration:.5,scale:1,ease:"circ.out"}),void l().then(()=>{i("Submit"),c=!0});d()}),r()});